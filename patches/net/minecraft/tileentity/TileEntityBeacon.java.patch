--- ../src-base/minecraft/net/minecraft/tileentity/TileEntityBeacon.java
+++ ../src-work/minecraft/net/minecraft/tileentity/TileEntityBeacon.java
@@ -33,8 +33,22 @@
 import net.minecraft.util.math.BlockPos;
 import net.minecraftforge.fml.relauncher.Side;
 import net.minecraftforge.fml.relauncher.SideOnly;
+import ru.svarka.inventory.ICBSidedInventory;
+import ru.svarka.tileentity.CBTileEntityLockable;
 
-public class TileEntityBeacon extends TileEntityLockable implements ITickable, ISidedInventory
+import org.bukkit.Location;
+import org.bukkit.craftbukkit.entity.CraftHumanEntity;
+import org.bukkit.craftbukkit.potion.CraftPotionUtil;
+import org.bukkit.entity.HumanEntity;
+
+//CraftBukkit start
+import org.bukkit.craftbukkit.entity.CraftHumanEntity;
+import org.bukkit.craftbukkit.potion.CraftPotionUtil;
+import org.bukkit.entity.HumanEntity;
+import org.bukkit.inventory.InventoryHolder;
+//CraftBukkit end
+
+public class TileEntityBeacon extends CBTileEntityLockable implements ITickable, ICBSidedInventory
 {
     public static final Potion[][] field_146009_a = new Potion[][] {{MobEffects.field_76424_c, MobEffects.field_76422_e}, {MobEffects.field_76429_m, MobEffects.field_76430_j}, {MobEffects.field_76420_g}, {MobEffects.field_76428_l}};
     private static final Set<Potion> field_184280_f = Sets.<Potion>newHashSet();
@@ -44,13 +58,45 @@
     @SideOnly(Side.CLIENT)
     private float field_146014_j;
     private boolean field_146015_k;
-    private int field_146012_l = -1;
+    public int field_146012_l = -1;
     @Nullable
-    private Potion field_146013_m;
+	public Potion field_146013_m;
     @Nullable
-    private Potion field_146010_n;
+	public Potion field_146010_n;
     private ItemStack field_146011_o;
     private String field_146008_p;
+    // CraftBukkit start - add fields and methods
+    public List<HumanEntity> transaction = new java.util.ArrayList<HumanEntity>();
+    private int maxStack = MAX_STACK;
+    
+    public ItemStack[] getContents() {
+    	        return new ItemStack[] { this.field_146011_o };
+    }
+    	
+    public void onOpen(CraftHumanEntity who) {
+    	transaction.add(who);
+    }
+    
+    public void onClose(CraftHumanEntity who) {
+    	transaction.remove(who);
+    }
+    	
+    public List<HumanEntity> getViewers() {
+    	return transaction;
+    }
+    	
+    public void setMaxStackSize(int size) {
+    	maxStack = size;
+    }
+    	
+    public org.bukkit.potion.PotionEffect getPrimaryEffect() {
+    	return (this.field_146013_m != null) ? CraftPotionUtil.toBukkit(new net.minecraft.potion.PotionEffect(this.field_146013_m, this.getLevel(), this.getAmplification(), true, true)) : null;
+    }
+    	
+    public org.bukkit.potion.PotionEffect getSecondaryEffect() {
+    	return (hasSecondaryEffect()) ? CraftPotionUtil.toBukkit(new net.minecraft.potion.PotionEffect(this.field_146010_n, this.getLevel(), this.getAmplification(), true, true)) : null;
+    }
+    // CraftBukkit end
 
     public void func_73660_a()
     {
@@ -68,41 +114,66 @@
             this.func_146000_x();
         }
     }
-
-    private void func_146000_x()
-    {
-        if (this.field_146015_k && this.field_146012_l > 0 && !this.field_145850_b.field_72995_K && this.field_146013_m != null)
-        {
-            double d0 = (double)(this.field_146012_l * 10 + 10);
+    private byte getAmplification() {
+        //if (this.isComplete && this.levels > 0 && !this.worldObj.isRemote && this.primaryEffect != null)
+        //{
+          //  double d0 = (double)(this.levels * 10 + 10);
             int i = 0;
 
             if (this.field_146012_l >= 4 && this.field_146013_m == this.field_146010_n)
             {
                 i = 1;
             }
-
-            int j = (9 + this.field_146012_l * 2) * 20;
+            return (byte) i;
+        //}
+        //return 0;
+    }
+    private int getLevel() {
+    	{
+            return (9 + this.field_146012_l * 2) * 20;
+    	}
+    }
+    public List getHumansInRange() {
+    	{
+    		double d0 = (double)(this.field_146012_l * 10 + 10);
             int k = this.field_174879_c.func_177958_n();
             int l = this.field_174879_c.func_177956_o();
             int i1 = this.field_174879_c.func_177952_p();
             AxisAlignedBB axisalignedbb = (new AxisAlignedBB((double)k, (double)l, (double)i1, (double)(k + 1), (double)(l + 1), (double)(i1 + 1))).func_186662_g(d0).func_72321_a(0.0D, (double)this.field_145850_b.func_72800_K(), 0.0D);
             List<EntityPlayer> list = this.field_145850_b.<EntityPlayer>func_72872_a(EntityPlayer.class, axisalignedbb);
-
+            return list;
+    	}
+    }
+    private void applyEffect(List<EntityPlayer> list, Potion effects, int i, int b0) {
+    	{
             for (EntityPlayer entityplayer : list)
             {
-                entityplayer.func_70690_d(new PotionEffect(this.field_146013_m, j, i, true, true));
+                entityplayer.func_70690_d(new PotionEffect(effects, i, b0, true, true));
             }
-
-            if (this.field_146012_l >= 4 && this.field_146013_m != this.field_146010_n && this.field_146010_n != null)
-            {
-                for (EntityPlayer entityplayer1 : list)
-                {
-                    entityplayer1.func_70690_d(new PotionEffect(this.field_146010_n, j, 0, true, true));
-                }
+    	}
+    }
+    private boolean hasSecondaryEffect() {
+    	if (this.field_146012_l >= 4 && this.field_146013_m != this.field_146010_n && this.field_146010_n != null)
+    	{
+    		//for (EntityPlayer entityplayer1 : list)
+    		//{
+    		//    entityplayer1.addPotionEffect(new PotionEffect(this.secondaryEffect, j, 0, true, true));
+    		//}
+    		return true;
+    	}
+    	return false;
+    }
+    private void func_146000_x() {
+        if (this.field_146015_k && this.field_146012_l > 0 && !this.field_145850_b.field_72995_K && this.field_146013_m != null) {
+            final byte b0 = this.getAmplification();
+            final int i = this.getLevel();
+            final List list = this.getHumansInRange();
+            this.applyEffect(list, this.field_146013_m, i, b0);
+            if (this.hasSecondaryEffect()) {
+                this.applyEffect(list, this.field_146010_n, i, 0);
             }
         }
     }
-
     private void func_146003_y()
     {
         int i = this.field_146012_l;
