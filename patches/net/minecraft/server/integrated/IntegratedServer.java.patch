--- ../src-base/minecraft/net/minecraft/server/integrated/IntegratedServer.java
+++ ../src-work/minecraft/net/minecraft/server/integrated/IntegratedServer.java
@@ -5,10 +5,12 @@
 import com.mojang.authlib.GameProfileRepository;
 import com.mojang.authlib.minecraft.MinecraftSessionService;
 import com.mojang.authlib.yggdrasil.YggdrasilAuthenticationService;
+
 import java.io.File;
 import java.io.IOException;
 import java.net.InetAddress;
 import java.util.concurrent.FutureTask;
+
 import net.minecraft.client.ClientBrandRetriever;
 import net.minecraft.client.Minecraft;
 import net.minecraft.client.multiplayer.ThreadLanServerPing;
@@ -33,6 +35,7 @@
 import net.minecraft.world.storage.WorldInfo;
 import net.minecraftforge.fml.relauncher.Side;
 import net.minecraftforge.fml.relauncher.SideOnly;
+
 import org.apache.logging.log4j.LogManager;
 import org.apache.logging.log4j.Logger;
 
@@ -82,11 +85,11 @@
         }
 
         WorldServer overWorld = (func_71242_L() ? (WorldServer)(new DemoWorldServer(this, isavehandler, worldinfo, 0, this.field_71304_b)).func_175643_b() :
-                                            (WorldServer)(new WorldServer(this, isavehandler, worldinfo, 0, this.field_71304_b)).func_175643_b());
+                                            (WorldServer)(new WorldServer(this, isavehandler, worldinfo, 0, this.field_71304_b, org.bukkit.World.Environment.getEnvironment(0), this.server.getGenerator(Integer.toString(0)))).func_175643_b());
         overWorld.func_72963_a(this.field_71350_m);
         for (int dim : net.minecraftforge.common.DimensionManager.getStaticDimensionIDs())
         {
-            WorldServer world = (dim == 0 ? overWorld : (WorldServer)(new WorldServerMulti(this, isavehandler, dim, overWorld, this.field_71304_b)).func_175643_b());
+            WorldServer world = (dim == 0 ? overWorld : (WorldServer)(new WorldServerMulti(this, isavehandler, dim, overWorld, this.field_71304_b, org.bukkit.World.Environment.getEnvironment(dim), this.server.getGenerator(Integer.toString(dim)))).func_175643_b());
             world.func_72954_a(new ServerWorldEventHandler(this, world));
             if (!this.func_71264_H())
             {
@@ -341,7 +344,7 @@
             {
                 for (EntityPlayerMP entityplayermp : Lists.newArrayList(IntegratedServer.this.func_184103_al().func_181057_v()))
                 {
-                    IntegratedServer.this.func_184103_al().func_72367_e(entityplayermp);
+                    IntegratedServer.this.func_184103_al().playerLoggedOut(entityplayermp);
                 }
             }
         }));
