--- ../src-base/minecraft/net/minecraftforge/common/DimensionManager.java
+++ ../src-work/minecraft/net/minecraftforge/common/DimensionManager.java
@@ -12,6 +12,7 @@
 import java.util.concurrent.ConcurrentMap;
 
 import org.apache.logging.log4j.Level;
+import org.bukkit.craftbukkit.CraftServer;
 
 import com.google.common.collect.HashMultiset;
 import com.google.common.collect.Lists;
@@ -71,8 +72,11 @@
         hasInit = true;
 
         registerDimension( 0, DimensionType.OVERWORLD);
-        registerDimension(-1, DimensionType.NETHER);
-        registerDimension( 1, DimensionType.THE_END);
+        
+        if(MinecraftServer.getServerStatic().func_71255_r())
+        	registerDimension(-1, DimensionType.NETHER);
+        if(MinecraftServer.getServerStatic().server.getAllowEnd())
+        	registerDimension( 1, DimensionType.THE_END);
     }
 
     public static void registerDimension(int id, DimensionType type)
@@ -208,7 +212,7 @@
         ISaveHandler savehandler = overworld.func_72860_G();
         //WorldSettings worldSettings = new WorldSettings(overworld.getWorldInfo());
 
-        WorldServer world = (dim == 0 ? overworld : (WorldServer)(new WorldServerMulti(mcServer, savehandler, dim, overworld, mcServer.field_71304_b).func_175643_b()));
+        WorldServer world = (dim == 0 ? overworld : (WorldServer)(new WorldServerMulti(mcServer, savehandler, dim, overworld, mcServer.field_71304_b, org.bukkit.World.Environment.getEnvironment(dim), mcServer.server.getGenerator(Integer.toString(dim))).func_175643_b()));
         world.func_72954_a(new ServerWorldEventHandler(mcServer, world));
         MinecraftForge.EVENT_BUS.post(new WorldEvent.Load(world));
         if (!mcServer.func_71264_H())
